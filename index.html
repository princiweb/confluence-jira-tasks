<html>
	<head>
		
	</head>
	<body>
		
		<table class="aui" >
	      <tbody>
	      <tr></tr>                 <tr>
	                                                                                             
	                                                    <th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span class="jim-table-header-content">Original Estimate</span></th>
	                                                                                                                                                   
	                                                    <th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span class="jim-table-header-content">Due</span></th>
	                                                                                </tr>
	                                                                                                                  <tr class="rowNormal">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              1 hour, 30 minutes
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              04/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                                                                                                  <tr class="rowAlternate">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              2 hours
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              04/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                                                                                                  <tr class="rowNormal">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              1 hour
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              04/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                                                                                                  <tr class="rowAlternate">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              35 minutes
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              04/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                                                                                                  <tr class="rowNormal">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              4 hours
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              05/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                                                                                                  <tr class="rowAlternate">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              1 hour
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              06/08/2015
	                                                                                                  </td>
	                                                  </tr>
																										<tr class="rowAlternate">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              1 day
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              06/08/2015
	                                                                                                  </td>
	                                                  </tr>
																										<tr class="rowAlternate">
	                                                                                                                      <td  class="jira-macro-table-underline-pdfexport" >
	                                                                                                              2 days
	                                                                                                  </td>
	                                                          <td nowrap="true" class="jira-macro-table-underline-pdfexport" >
	                                                                                                              06/08/2015
	                                                                                                  </td>
	                                                  </tr>
	                                                                      
	                      </tbody>
	  </table>
		
		<table id="sum-results">
			
		<table>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script type="text/javascript">
		  var existeEstimativa = $('.jira-tablesorter-header:contains("Original Estimate")').length > 0;
			
			if (existeEstimativa)
			{
		 		var tabela = $('.jira-tablesorter-header:contains("Original Estimate")').parents('table');
				
				var soma = 0;
				var dueDate = '';
				var horas = 0;
				var minutos = 0;
				var trColor = '';
				
			 	$('tr:gt(1)', tabela).each(function() {
				 
				 	var dueDateProximo = $('td:eq(1)', $(this).next('tr')).html();
				 
					dueDate = $('td:eq(1)', this).html();
				 
					var valorEstimativa = $('td:first', this).html();
					
					if(valorEstimativa) {
					
						var conteudoEstimativa = valorEstimativa.trim().split(' ');						
						var ehHoraComMinutos = valorEstimativa.trim().indexOf(', ') !== -1
		
						valorEstimativa = conteudoEstimativa[0];
						
						var tipoValor = conteudoEstimativa[1];
						
						if(tipoValor.indexOf('hour') >= 0) {
							soma += +valorEstimativa * 60;
							
							if (ehHoraComMinutos) {
								
								var valorMinutos = +conteudoEstimativa[2];
								
								soma += +valorMinutos;
								
							}
							
						} else if (tipoValor.indexOf('day') >= 0) {							
							soma += +valorEstimativa * 480;						
						} else {
							soma += +valorEstimativa;
						}
						
					}
					
					if (dueDateProximo !== dueDate) {
						horas = Math.floor(soma/60);
						minutos = soma % 60;
						
						if (horas > 6) {
							trColor = '#f5a1a1';	
						} else {
							trColor = '#c7e5bc';	
						}
						
					 	tabela.append('<tr class="results"><td style="background-color: ' + trColor + '">' + dueDate + '</td><td style="background-color: ' + trColor + '">' + horas.toString() + 'h ' + minutos + 'm</td></tr>');
						soma = 0;
			 		}
					
			 	});
				 
			 	tabela.find('tr:not(.results)').remove();
				 
			 	$('<tr><th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span class="jim-table-header-content">Data</span></th><th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header"><span class="jim-table-header-content">Horas</span></th></tr>').prependTo(tabela);
				 
	 			$('.refresh-action').click(function() {
					 location.reload();
			 	});
			}
		</script>
	</body>
</html>