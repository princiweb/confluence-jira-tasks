<html>
	<head>

	</head>
	<body>

<table class="aui">
	<tbody>
		<tr></tr>
		<tr>

			<th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header">
				<span class="jim-table-header-content">Original Estimate</span>
			</th>

			<th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header">
				<span class="jim-table-header-content">Due</span>
			</th>
			<th style="text-align: left; text-transform: capitalize;" class="jira-macro-table-underline-pdfexport jira-tablesorter-header">
				<span class="jim-table-header-content">Project</span>
			</th>
		</tr>
		<tr class="rowNormal">
			<td class="jira-macro-table-underline-pdfexport">
				1 hour, 30 minutes
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				04/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				Imuneasy
			</td>
		</tr>
		<tr class="rowAlternate">
			<td class="jira-macro-table-underline-pdfexport">
				2 hours
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				04/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				Imuneasy
			</td>
		</tr>
		<tr class="rowNormal">
			<td class="jira-macro-table-underline-pdfexport">
				1 hour
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				04/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				PrinciWeb
			</td>
		</tr>
		<tr class="rowAlternate">
			<td class="jira-macro-table-underline-pdfexport">
				35 minutes
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				04/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				PrinciWeb
			</td>
		</tr>
		<tr class="rowNormal">
			<td class="jira-macro-table-underline-pdfexport">
				4 hours
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				05/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				Imuneasy
			</td>
		</tr>
		<tr class="rowAlternate">
			<td class="jira-macro-table-underline-pdfexport">
				1 hour
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				06/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				Imuneasy
			</td>
		</tr>
		<tr class="rowAlternate">
			<td class="jira-macro-table-underline-pdfexport">
				1 day
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				06/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				PrinciWeb
			</td>
		</tr>
		<tr class="rowAlternate">
			<td class="jira-macro-table-underline-pdfexport">
				2 days
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				06/08/2015
			</td>
			<td nowrap="true" class="jira-macro-table-underline-pdfexport">
				PrinciWeb
			</td>
		</tr>

	</tbody>
</table>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script>
			var tabela = $(".aui");
			var tabelaCompleta = [];
			tabela.find('tbody tr.rowNormal, tbody tr.rowAlternate').each(function(){

				var objeto = {
					"tempoEstimadoMinutos": resumirDataEmMinutos($(this).find("td")[0].innerText),
					"dueDate": $(this).find("td")[1].innerText,
					"projeto": $(this).find("td")[2].innerText
				}
				tabelaCompleta.push(objeto);



			});
			console.log(tabelaCompleta);

			var tabelaResumida = tabelaCompleta.reduce(
				function (arrayResumido,objeto){
					if(arrayResumido.length){
						if( arrayResumido[arrayResumido.length - 1].dueDate == objeto.dueDate ){
							arrayResumido[arrayResumido.length - 1].tempoEstimadoMinutos += objeto.tempoEstimadoMinutos;
							if(arrayResumido[arrayResumido.length - 1].projeto.indexOf(objeto.projeto) == -1)
								arrayResumido[arrayResumido.length - 1].projeto += ", "+objeto.projeto;
						}else{
							arrayResumido.push(objeto);
						}
					}else{
						arrayResumido.push(objeto);
					}
					return arrayResumido;
				}, []
			);

			console.log(tabelaResumida);
			var htmlTabelaResumida = "<tr><th>Projetos</th><th>Data</th><th>Horas</th></tr>";
			tabelaResumida.forEach(function (linha){
				console.log(linha);
				var cor = (linha.tempoEstimadoMinutos > (6*60))?'#f5a1a1':'#c7e5bc';
				htmlTabelaResumida+= "<tr style='background-color:"+cor+"'> <td>"+linha.projeto+"</td> <td>"+linha.dueDate+"</td> <td>"+embelezarTempo(linha.tempoEstimadoMinutos)+"</td> </tr>";
			});
			htmlTabelaResumida += "</table>";
			tabela.html(htmlTabelaResumida);

			function embelezarTempo(tempo){
				var horas = Math.floor(tempo / 60);
				var minutos = Math.floor(tempo % 60);
				return horas + "h "+minutos+"m";
			}

			function resumirDataEmMinutos(data){
				var regexTempoEstimado = /(([0-9]+) weeks?)?(, )?(([0-9]+) days?)?(, )?(([0-9]{1,2}) hours?)?(, )?(([0-9]{1,2}) minutes?)?/i
				var horasRegexADA =regexTempoEstimado.exec(data);

				var minutosSemanas = Number(horasRegexADA[2]*60*24*7) || 0;
				var minutosDias = Number(horasRegexADA[5]*60*24) || 0;
				var minutosHoras = Number(horasRegexADA[8]*60) || 0;
				var Minutos = Number(horasRegexADA[11]) || 0;

				var resumo = minutosSemanas + minutosDias + minutosHoras + Minutos;

				return resumo;
			}
		</script>

	</body>
</html>
